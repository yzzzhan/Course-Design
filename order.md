
### 一、项目结构

1. **整体结构**

   本项目是一个基于 Vue.js 的前端应用和 Express 后端的点餐系统。前端和后端代码分别位于不同的文件中，通过 HTTP 请求进行交互。项目的主要目录结构如下：

   - **`components`目录**：包含了多个 Vue 组件，这些组件构成了应用的不同页面和功能模块，如 `AddDish`、`Checkout`、`Menu`、`OrderSummary`和 `Sidebar`组件。
   - **`router`目录**：包含 `index.js`文件，用于定义 Vue 路由，将不同的 URL 路径映射到相应的组件。
   - **`store`目录**：包含 `index.js`文件，用于创建 Vuex 存储，管理应用的状态，包括购物车、菜品、订单、桌号和支付状态等信息。
   - **`main.js`文件**：是 Vue 应用的入口点，在这里创建 Vue 实例，注册 Vuex 存储和 Vue 路由，并将应用挂载到 `#app`元素上。
   - **后端 `server`部分**：一个单独的 Express 应用，位于一个 JavaScript 文件中，实现了多个接口来处理前端的请求。
2. **组件结构（以 `components`目录为例）**

   - **`AddDish`组件**：
     - **`template`部分**：定义了一个表单，用于输入菜品的名称、价格、库存，并提供文件上传功能来添加菜品图片，还有一个提交按钮。
     - **`script`部分**：在 `data`函数中初始化了一个 `newDish`对象和 `dishes`数组。`handleImageUpload`方法处理图片上传，通过 `axios`将图片文件以 `form - data`格式发送到 `/upload - image`后端接口，接收并存储返回的图片 URL。`addDish`方法在用户提交表单时，先检查是否上传了图片，然后将菜品信息通过 `axios`发送到 `/add - dish`后端接口，如果添加成功，会更新 Vuex 存储中的菜品列表，并清空表单。
     - **`style`部分**：对表单和表单元素的样式进行了定义，包括布局、输入框样式、按钮样式等。
   - **`Checkout`组件**：
     - **`template`部分**：展示当前桌号、购物车内容（如果有）、商品总价和支付按钮，同时也展示历史订单信息（如果有）。
     - **`script`部分**：通过 `computed`属性获取 Vuex 存储中的购物车、桌号、订单和总价信息。`makePayment`方法用于处理支付功能，首先检查总价是否有效，然后通过 `axios`将支付信息（桌号、总价和购物车内容）发送到 `/payment`后端接口。根据后端返回的结果，更新支付状态和订单信息（如果支付成功）。`placeOrder`方法用于在支付成功后，调用 Vuex 的 `action`来存储订单信息。
     - **`style`部分**：对结算页面的整体样式、购物车内容展示样式、支付按钮样式和历史订单展示样式进行了定义，包括背景颜色、边框、阴影、字体大小和颜色等。
   - **`Menu`组件**：
     - **`template`部分**：有一个搜索框用于搜索菜品，展示菜品列表（如果有），每个菜品显示名称、价格、库存和加入购物车按钮，同时还实现了分页功能，并在有桌号时显示桌号信息。
     - **`script`部分**：通过 `computed`属性获取 Vuex 存储中的菜品和购物车信息，并根据搜索框的输入过滤菜品列表，计算总页数和当前页的菜品列表。`addToCart`方法用于将菜品添加到购物车，减少菜品库存，并在没有桌号时生成一个桌号。`changePage`方法用于切换页面，`getImageUrl`方法获取菜品图片的 URL，`generateTableNumber`方法生成桌号，`searchDishes`方法在搜索输入时重置当前页为 1。
     - **`style`部分**：对菜单页面的整体样式、搜索框样式、菜品列表布局、菜品项样式、分页按钮样式和桌号显示样式进行了定义，包括背景颜色、边框、阴影、字体大小和颜色、按钮样式、图片显示样式等。
   - **`OrderSummary`组件**：
     - **`template`部分**：展示订单总览信息，包括桌号、下单时间、订单状态、菜品信息和总价，对于已下单的订单有一个出餐按钮。
     - **`script`部分**：通过 `computed`属性获取并按时间降序排序 Vuex 存储中的订单信息。`markAsServed`方法用于将订单状态标记为已出单，通过调用 Vuex 的 `mutation`来更新订单状态。
     - **`style`部分**：对订单总览页面的标题样式、订单项样式、按钮样式和文本样式进行了定义，包括字体大小、颜色、背景颜色、边框、阴影等，同时也考虑了不同屏幕尺寸下的样式调整。
   - **`Sidebar`组件**：
     - **`template`部分**：包含几个按钮，用于导航到不同的页面，如点餐、结算、上架菜品和订单总览。
     - **`script`部分**：`navigate`方法用于通过 Vue Router 实现页面导航，根据按钮点击的页面名称，将用户路由到相应的组件。
     - **`style`部分**：对侧边栏的标题和按钮的样式进行了定义，包括颜色、背景颜色、边框、半径、鼠标悬停和点击效果等，同时也考虑了不同屏幕尺寸下按钮的布局调整。
3. **路由（`router/index.js`）**
   定义了四个路由路径 `/`（映射到 `Menu`组件）、`/checkout`（映射到 `Checkout`组件）、`/add - dish`（映射到 `AddDish`组件）和 `/order - summary`（映射到 `OrderSummary`组件），通过 `createRouter`和 `createWebHistory`创建路由实例，并将其导出供 `main.js`使用。
4. **Vuex 存储（`store/index.js`）**

   - **`state`对象**：包含了应用的核心状态数据，如购物车 `cart`（存储用户选择的菜品和数量）、菜品列表 `dishes`（包含所有可点的菜品信息）、订单列表 `orders`（存储用户的历史订单）、桌号 `tableNumber`和支付状态 `paymentStatus`。
   - **`getters`**：定义了一些获取状态数据的方法，方便在组件中获取 Vuex 存储中的数据。
   - **`mutations`**：包含一系列修改状态的方法，如 `addToCart`（添加菜品到购物车）、`increaseQuantity`（增加购物车中菜品的数量）、`decreaseQuantity`（减少购物车中菜品的数量）、`addDish`（添加新菜品到菜品列表）、`generateTableNumber`（生成桌号）、`updatePaymentStatus`（更新支付状态）、`placeOrder`（添加订单到订单列表）、`clearCart`（清空购物车）和 `markAsServed`（标记订单为已出单）。
   - **`actions`**：定义了一个 `placeOrder`的异步 `action`，用于创建新订单并清空购物车，在支付成功后调用。
5. **后端结构（`server`部分）**

   - 使用 `Express`框架搭建后端服务器。
   - **`express`、`multer`、`path`和 `cors`模块的引入**：`express`用于创建服务器应用，`multer`用于处理文件上传，`path`用于处理文件路径，`cors`用于配置跨域资源共享。
   - **`upload`对象**：通过 `multer`配置，指定文件上传的目标目录为 `uploads/`。
   - **`app.use`方法的调用**：
     - 配置 `CORS`，允许来自 `http://localhost:5173`的请求。
     - 将 `/uploads`路径设置为静态文件服务，用于访问上传的图片。
     - 使用 `express.urlencoded`和 `express.json`中间件来解析前端发送的表单数据和 JSON 数据。
   - **接口定义**：
     - **`/upload - image`接口**：接受 `POST`请求，处理图片上传。如果没有文件上传，返回 400 错误。上传成功后，返回包含图片 URL 的 JSON 数据。
     - **`/add - dish`接口**：接受 `POST`请求，接收包含菜品名称、价格、库存和图片 URL 的 JSON 数据。如果数据不完整，返回 400 错误。成功添加菜品后，返回成功信息和菜品数据。
     - **`/payment`接口**：接受 `POST`请求，接收桌号、总价和购物车信息。如果总价大于 0，则创建新订单，将订单信息存储在内存中的 `orders`数组中，并返回支付成功信息和订单详情。如果总价不大于 0，则返回支付失败信息。
     - **`/orders`接口**：接受 `GET`请求，返回存储在内存中的所有订单信息。

### 二、功能实现

1. **菜品上架功能（`AddDish`组件）**

   - 用户可以在表单中输入菜品的名称、价格和库存信息，并上传菜品图片。
   - 点击提交按钮后，前端通过 `axios`将菜品信息（包括图片 URL）发送到后端 `/add - dish`接口。
   - 后端接收到数据后，进行简单的校验，如果数据完整则将菜品信息存储（这里只是模拟存储，实际应用可能需要数据库操作），并返回成功信息给前端。前端在收到成功信息后，更新本地的菜品列表（通过 Vuex 存储），并清空表单，方便用户添加下一个菜品。
2. **点餐功能（`Menu`组件）**

   - 用户可以在搜索框中输入关键词来搜索菜品。
   - 菜品以列表形式展示，每个菜品显示名称、价格、库存和加入购物车按钮。如果库存为 0，加入购物车按钮将被禁用。
   - 点击加入购物车按钮，会将菜品添加到购物车（通过 Vuex 存储），同时减少菜品的库存。如果用户没有桌号，系统会自动生成一个随机桌号。
   - 分页功能允许用户浏览更多菜品，每页显示固定数量的菜品。
3. **结算功能（`Checkout`组件）**

   - 展示当前桌号和购物车中的菜品信息、商品总价。
   - 用户点击支付按钮后，前端通过 `axios`将桌号、总价和购物车内容发送到后端 `/payment`接口。
   - 后端根据总价判断支付是否成功，如果成功则创建新订单（存储在内存中的 `orders`数组），并返回订单信息给前端。前端在收到支付成功信息后，更新订单列表（通过 Vuex 存储）、支付状态，并清空购物车。如果支付失败，前端仅更新支付状态。
   - 同时，该组件还展示历史订单信息，包括桌号、下单时间、订单状态、菜品信息和总价。
4. **订单管理功能（`OrderSummary`组件）**

   - 展示所有订单的总览信息，按照下单时间降序排列。
   - 对于已下单的订单，有一个出餐按钮。点击该按钮可以将订单状态标记为已出单（通过调用 Vuex 的 `mutation`来更新订单状态）。
5. **导航功能（`Sidebar`组件）**
   提供了方便的导航功能，用户可以通过点击不同的按钮（点餐、结算、上架菜品、订单总览）在不同的功能页面之间进行切换。
6. **整体数据管理（通过 Vuex 和后端交互）**

   - Vuex 存储在前端管理应用的核心数据，如购物车、菜品、订单、桌号和支付状态等，各个组件可以通过 `getters`、`mutations`和 `actions`来获取和修改这些数据。
   - 后端通过接口接收前端的数据请求，处理业务逻辑（如添加菜品、处理支付、管理订单），并返回相应的结果给前端，实现前后端的数据交互和业务流程的处理。整个系统通过这种方式实现了一个完整的点餐流程，包括菜品管理、点餐、结算和订单管理等功能。
